# システムパターン

## システムアーキテクチャ
- **フロントエンド**: StreamlitによるインタラクティブなWeb UI
- **データレイヤー**: CSVまたはJSONファイルによる静的データ管理
- **マッピングレイヤー**: Foliumを使用した地図表示

## 主要コンポーネント
1. **データコレクター** (`data_collector.py`): 
   - 温泉データの収集・加工モジュール
   - Wikipediaからデータをスクレイピング
   - 位置情報をジオコーディングAPIで取得
   - CSV/JSON形式でデータを保存

2. **データローダー** (`data_loader.py`):
   - データの読み込みと前処理
   - DataFrame形式でのデータ管理
   - 都道府県・名称によるフィルタリング機能

3. **マップビュー** (`map_view.py`): 
   - 地図表示と温泉マーカー管理
   - クラスタリング機能による多数マーカーの効率的表示
   - マーカーのカスタマイズとポップアップ表示

4. **アプリケーション** (`app.py`):
   - StreamlitベースのUIコントロール
   - ユーザーインタラクション管理
   - データ表示とフィルタリングコンポーネント

## データフロー
1. `OnsenDataCollector`がWebからデータを収集し、CSV/JSONファイルに保存
2. `OnsenDataLoader`が静的データファイルからデータをロード
3. Pandas DataFrameでデータを操作・フィルタリング
4. `OnsenMapView`がFoliumを使って地図にマーカーを配置
5. Streamlit UIで表示とユーザー操作を管理
6. フィルタリングや検索結果に応じて2～5を繰り返し

## 設計原則
- コンポーネントの分離と単一責任の原則
- データと表示の分離
- クラスベース設計によるカプセル化と再利用性
- 拡張性を考慮したモジュール設計
- 設定の外部化（ディレクトリパスなど）
- エラーハンドリングの一貫性

## ファイル構造
```
onsen-map/
├── data/              # データ格納ディレクトリ
│   ├── onsen_data.csv # 収集した温泉データ
│   └── images/        # 将来的な画像保存用ディレクトリ
├── src/               # ソースコードディレクトリ
│   ├── app.py         # メインアプリケーション
│   ├── data_collector.py # データ収集モジュール
│   ├── data_loader.py # データ読み込みモジュール
│   └── map_view.py    # マップ表示モジュール
└── tests/             # テストコードディレクトリ
```
